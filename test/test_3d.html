<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Animation</title>
    <script type="text/javascript" src="../lib/requirejs.js"></script>
</head>
<body>
    <script type="text/javascript">
    require.config({
        packages: [
            {
                name: 'angel',
                location: '../src',
                main: 'angel'
            }
        ]
    });
    require(
        [
            "angel/angel",
            "angel/shape/Rect",
            "angel/shape/3D/Cube"
        ], 
        function(Angel, RectShape, Cube){

            // 初始化angel 3d
            var angel = Angel.init( document.getElementById("Main"));
            var camera = angel.createCamera({
                position: [125, 125, 0]
            });
            var rect = new Cube({
                    scale : [1, 1],
                    zlevel: 1,
                    style : {
                        x : 100,
                        y : 100,
                        d : 50,
                        z : 0, // 3D 属性
                        brushType : 'stroke',
                        strokeStyle : 'rgba(0, 0, 0, 1)',
                        lineWidth : 1
                    }
                });
            angel.addShape(rect);

            for(var i=0;i<10;i++){
                var rect2 = new RectShape({
                    scale : [1, 1],
                    zlevel: 1,
                    style : {
                        x : Math.random()*200,
                        y : Math.random()*200,
                        w : 10,
                        h : 10,
                        z : Math.random()*80 - 40, // 3D 属性
                        brushType : 'stroke',
                        strokeStyle : 'rgba(' + Math.ceil(Math.random()*200) + ', ' + Math.ceil(Math.random()*200) + ', 255, 1)',
                        lineWidth : 1
                    }
                });
                angel.addShape(rect2);
            }
            angel.render();

                
            setInterval(function(){
                listener.focus();
            }, 1000);
            // 事件监控，检测前进、后退、左右移动、鼠标视角变化
            var listener = document.getElementById('listener');
            var up,down,left,right;
            listener.onkeypress = function(e){
                if(e.keyCode === 97){
                    left = left || setInterval(function(){
                        camera.move('x', -5);
                    }, 30);
                }
                else if(e.keyCode === 100){
                    right = right || setInterval(function(){
                        camera.move('x', +5);
                    }, 30);
                }
                if(e.keyCode === 119){
                    up = up || setInterval(function(){
                        camera.move('z', +5);
                    }, 30);
                }
                else if(e.keyCode === 115){
                    down = down || setInterval(function(){
                        camera.move('z', -5);
                    }, 30);
                }
            }
            listener.onkeyup = function(e){
                if(e.keyCode === 65){
                    clearInterval(left);
                    left = null;
                }
                else if(e.keyCode === 68){
                    clearInterval(right);
                    right = null;
                }
                if(e.keyCode === 87){
                    clearInterval(up);
                    up = null;
                }
                else if(e.keyCode === 83){
                    clearInterval(down);
                    down = null;
                }
            }
            // 鼠标事件
            var container = document.getElementById("Main"),
                centerX = container.clientWidth/2,
                centerY = container.clientHeight/2,
                x,y;
            container.onmousemove = function(e){
                x = e.clientX;
                y = e.clientY;
                camera.aim(x - centerX, y - centerY);
            }

            // 画面更新
            setInterval(function(){
                angel.render();
            }, 30);

        });
    </script>
    <div id="Main" style="width:1000px;height:400px;border:1px solid;"></div>
    <input id="listener" type="text" maxlength=1 style=""></input>
</body>
</html>